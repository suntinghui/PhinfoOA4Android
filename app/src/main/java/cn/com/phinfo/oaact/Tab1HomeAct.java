package cn.com.phinfo.oaact;import java.io.Serializable;import java.util.ArrayList;import java.util.Iterator;import java.util.List;import java.util.Stack;import com.alibaba.fastjson.JSON;import com.heqifuhou.protocolbase.HttpResultBeanBase;import com.heqifuhou.pulltorefresh.PullToRefreshBase.Mode;import com.heqifuhou.pulltorefresh.PullToRefreshListView;import com.heqifuhou.tab.HttpMyActTabChildBase;import com.heqifuhou.toprightmenu.MenuItem;import com.heqifuhou.toprightmenu.TopRightMenu;import android.content.Intent;import android.os.Bundle;import android.util.Log;import android.view.View;import android.view.View.OnClickListener;import android.widget.AdapterView;import android.widget.AdapterView.OnItemClickListener;import cn.com.phinfo.adapter.HomeTab1Adapter;import cn.com.phinfo.entity.HomeItem;import cn.com.phinfo.entity.HomeTab1Item;import cn.com.phinfo.protocol.LURLInterface;import cn.com.phinfo.protocol.MessageStaticsListRun;public class Tab1HomeAct extends HttpMyActTabChildBase implements OnItemClickListener{	private static int ID_MESSAGE_STATIC_LIST = 0x10;	private PullToRefreshListView pullToRefreshListView;	private HomeTab1Adapter adapter;	public void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		this.addTextNav(new OnClickListener() {			@Override			public void onClick(View arg0) {				showPopMenu();			}		}, "消息",R.drawable.more_add);		this.hideBackNav();		this.addViewFillInRoot(R.layout.act_home);		pullToRefreshListView = (PullToRefreshListView) this.findViewById(R.id.refreshListView);		pullToRefreshListView.setMode(Mode.DISABLED);		adapter = new HomeTab1Adapter();		pullToRefreshListView.setAdapter(adapter);		pullToRefreshListView.setOnItemClickListener(this);	}	@Override	protected void onResume() {		super.onResume();		this.onRefresh();	}	private TopRightMenu mTopRightMenu=null;	private void showPopMenu(){		mTopRightMenu = new TopRightMenu(this);		//添加菜单项		List<MenuItem> menuItems = new ArrayList<>();		menuItems.add(new MenuItem(R.drawable.ic_h_q, "扫一扫"));//		menuItems.add(new MenuItem(R.drawable.ic_h_u, "优盘"));//		menuItems.add(new MenuItem(R.drawable.ic_h_e, "邮件"));		mTopRightMenu		        .setHeight(600)     //默认高度480		        .setWidth(420)      //默认宽度wrap_content		        .showIcon(true)     //显示菜单图标，默认为true		        .dimBackground(true)        //背景变暗，默认为true		        .needAnimationStyle(true)   //显示动画，默认为true		        .setAnimationStyle(R.style.TRM_ANIM_STYLE)		        .addMenuList(menuItems)		        .setOnMenuItemClickListener(new TopRightMenu.OnMenuItemClickListener() {		              @Override		              public void onMenuItemClick(int position) {		                 //二维码		                if(position==0){		            		Intent intent = new Intent(Tab1HomeAct.this,HomeCaptureAct.class);		            		intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);		            		startActivity(intent);		                 }		                //优盘		                else if(position==1){		            		Intent intent = new Intent(Tab1HomeAct.this,UAct.class);		            		intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);		            		startActivity(intent);		                 }		                //邮件		                else if(position==2){		            		Intent intent = new Intent(Tab1HomeAct.this,EmailAct.class);		            		intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);		            		startActivity(intent);		                 }		              }		        })		        .showAsDropDown(this.findViewById(R.id.nav_btn_img), -225, 0);	//带偏移量	}		public void onHttpForResult(int id, HttpResultBeanBase obj, Object requestObj) {		super.onHttpForResult(id, obj, requestObj);		pullToRefreshListView.onRefreshComplete();// 下拉请求完成	}	protected void onRefresh() {		this.quickHttpRequest(ID_MESSAGE_STATIC_LIST, new MessageStaticsListRun());	}	@Override	protected void onHttpResult(int id, HttpResultBeanBase obj, Object requestObj) {		if (id == ID_MESSAGE_STATIC_LIST) {			if (obj.isOK()) {				adapter.clear();				MessageStaticsListRun.MessageStaticResultBean bean = (MessageStaticsListRun.MessageStaticResultBean)obj;				List<MessageStaticsListRun.MessageStaticItem> list = bean.getListDta();				Iterator<MessageStaticsListRun.MessageStaticItem> it = list.iterator();				while (it.hasNext()) {					MessageStaticsListRun.MessageStaticItem item = it.next();					adapter.addToListBack(HomeTab1Item.create(item.getModuleId()));				}			} else {				showToast(obj.getMsg());			}		}	}	@Override	public void onItemClick(AdapterView<?> arg0, View arg1, int arg2, long arg3) {		HomeTab1Item it = adapter.getItem(arg2-1);		//查看新闻内容		if(it.getId()== 104){//			startNewsActt();			startNewsActt(it,1);		}	   //通知		if(it.getId()== 702){			startNewsActt(it,2);		}		//查看待办内容		if(it.getId()== 101){			startTodosActt();		}		//查看优盘内容		if(it.getId()== 106){			startUFileAct();		}		//查看邮件内容		if(it.getId()== 107){			startEmailAct();		}		//查看日志		if(it.getId()== 110){			startReprotAct();		}	}		private void startNewsActt(HomeTab1Item _it,int contentTypeCode){		List<HomeItem> ls = new Stack<HomeItem>();//		for(int i=0;i<adapterlst.length;i++){//			ls.addAll(adapterlst[i].getNewsItemList());//		}		HomeItem it = new HomeItem();		it.setLabel(_it.getText());		Intent intent = new Intent(this,NewsAct.class);		intent.putExtra("NEWSLIST", (Serializable)ls);		intent.putExtra("HomeItem", it);		intent.putExtra("contentTypeCode", contentTypeCode);		intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);		this.startActivity(intent);	}	private void startNewsActt(){		Intent intent = new Intent(this,NewsAct.class);		intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);		this.startActivity(intent);	}	private void startReprotAct(){		Intent intent = new Intent(this,ReportAct.class);		intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);		this.startActivity(intent);	}				private void startTodosActt(){		Intent intent = new Intent(this,TodosAct.class);		intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);		this.startActivity(intent);	}	private void startUFileAct(){		Intent intent = new Intent(this,UAct.class);		intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);		this.startActivity(intent);	}	private void startEmailAct(){		Intent intent = new Intent(this,EmailAct.class);		intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);		this.startActivity(intent);	}}