package cn.com.phinfo.protocol;import java.text.SimpleDateFormat;import java.util.Calendar;import java.util.Date;import java.util.List;import java.util.Stack;import cn.com.phinfo.protocol.GetDailyRun.DailyItem;import com.alibaba.fastjson.annotation.JSONField;import com.baidu.mapapi.model.LatLng;import com.baidu.mapapi.utils.DistanceUtil;import com.heqifuhou.protocolbase.HttpResultBeanBase;import com.heqifuhou.protocolbase.QuickRunObjectBase;import com.heqifuhou.utils.ParamsCheckUtils;public class AttentdsettingsRun extends QuickRunObjectBase {	public AttentdsettingsRun() {		super(LURLInterface.GET_attend_empdaily(),null,AttentdsettingsResultBean.class);	}	public static class AttentdsettingsResultBean extends HttpResultBeanBase{		private AttentdSettingsData data = new AttentdSettingsData();		public AttentdSettingsData getData() {			return data;		}		public void setData(AttentdSettingsData data) {			this.data = data;		}	}	public static class AttentdSettingsData{		private List<LocationsItem> locations = new Stack<LocationsItem>();		private List<WifisItem> wifis = new Stack<WifisItem>();		private GlobalSettingsItem globalSettings = new GlobalSettingsItem();		private UserSettingsItem userSettings = new UserSettingsItem();		private List<DailyItem> attendData = new Stack<DailyItem>();		public List<DailyItem> getAttendData() {			return attendData;		}		public void setAttendData(List<DailyItem> attendData) {			this.attendData = attendData;		}		public List<LocationsItem> getLocations() {			return locations;		}		public void setLocations(List<LocationsItem> locations) {			this.locations = locations;		}		public List<WifisItem> getWifis() {			return wifis;		}		public void setWifis(List<WifisItem> wifis) {			this.wifis = wifis;		}		public GlobalSettingsItem getGlobalSettings() {			return globalSettings;		}		public void setGlobalSettings(GlobalSettingsItem globalSettings) {			this.globalSettings = globalSettings;		}		public UserSettingsItem getUserSettings() {			return userSettings;		}		public void setUserSettings(UserSettingsItem userSettings) {			this.userSettings = userSettings;		}		@JSONField(serialize=false)		public WifisItem isWifiWork(String Name,String AttendWifiId){			for(WifisItem it:wifis){				if(it.isNetWork(Name, AttendWifiId)){					return it;				}			}			return null;		}		@JSONField(serialize=false)		public LocationsItem isInDistanceRange(double lat,double lon,double dis){			for(LocationsItem it:locations){				if(it.isInDistanceRange(lat, lon,dis)){					return it;				}			}			return null;		}	} 		public static class LocationsItem{		private String Name;//": "将台西路19号院1号楼",		private String Longitude;//": "", //经度		private String Latitude;//": "",  //纬度		private String AttendLocationId;//": "9215b2e8-2a49-46ba-a173-8ff501d35443",		private String CreatedOn;//": "2017/4/2 21:23:11",		private String CreatedBy;//": "",		private String ModifiedOn;//": "2017/4/2 21:23:11",		private String ModifiedBy;//": ""		public String getName() {			return Name;		}		public void setName(String name) {			Name = name;		}		public String getLongitude() {			return Longitude;		}		public void setLongitude(String longitude) {			Longitude = longitude;		}		public String getLatitude() {			return Latitude;		}		public void setLatitude(String latitude) {			Latitude = latitude;		}		public String getAttendLocationId() {			return AttendLocationId;		}		public void setAttendLocationId(String attendLocationId) {			AttendLocationId = attendLocationId;		}		public String getCreatedOn() {			return CreatedOn;		}		public void setCreatedOn(String createdOn) {			CreatedOn = createdOn;		}		public String getCreatedBy() {			return CreatedBy;		}		public void setCreatedBy(String createdBy) {			CreatedBy = createdBy;		}		public String getModifiedOn() {			return ModifiedOn;		}		public void setModifiedOn(String modifiedOn) {			ModifiedOn = modifiedOn;		}		public String getModifiedBy() {			return ModifiedBy;		}		public void setModifiedBy(String modifiedBy) {			ModifiedBy = modifiedBy;		}		@JSONField(serialize=false)		public boolean isInDistanceRange(double lat,double lon,double dis){			if(ParamsCheckUtils.isNull(this.getLatitude())){				return false;			}			if(ParamsCheckUtils.isNull(this.getLongitude())){				return false;			}			LatLng loc = new LatLng(lat,lon);			LatLng l  = new LatLng(Double.parseDouble(this.getLatitude()),Double.parseDouble(this.getLongitude()));			double d = DistanceUtil.getDistance(loc,l);			if(d<dis){				return true;			}			return false;		}	}		public static class WifisItem{		@JSONField(serialize=false)		public boolean  isNetWork(String Name,String AttendWifiId){			if(Name.toLowerCase().equals(this.Name.toLowerCase())&&AttendWifiId.toLowerCase().equals(this.Address.toLowerCase())){				return true;			}			return false;		}				private String Name;//": "jackliu", //wifi名称		private String Address;//": "192.168.0.1", //wifi地址		private String AttendWifiId;//": "21a2a6c1-de04-4575-9e21-7a1f199b5de5",		private String CreatedOn;//": "2017/4/16 10:37:23",		private String CreatedBy;//": "27a909e1-9fb4-4c67-afcd-3dc9032fdd6b",		private String ModifiedOn;//": "2017/4/16 10:37:23",		private String ModifiedBy;//": "27a909e1-9fb4-4c67-afcd-3dc9032fdd6b"		public String getName() {			return Name;		}		public void setName(String name) {			Name = name;		}		public String getAddress() {			return Address;		}		public void setAddress(String address) {			Address = address;		}		public String getAttendWifiId() {			return AttendWifiId;		}		public void setAttendWifiId(String attendWifiId) {			AttendWifiId = attendWifiId;		}		public String getCreatedOn() {			return CreatedOn;		}		public void setCreatedOn(String createdOn) {			CreatedOn = createdOn;		}		public String getCreatedBy() {			return CreatedBy;		}		public void setCreatedBy(String createdBy) {			CreatedBy = createdBy;		}		public String getModifiedOn() {			return ModifiedOn;		}		public void setModifiedOn(String modifiedOn) {			ModifiedOn = modifiedOn;		}		public String getModifiedBy() {			return ModifiedBy;		}		public void setModifiedBy(String modifiedBy) {			ModifiedBy = modifiedBy;		}	}	public static class GlobalSettingsItem{		private String FlexTime;//": "10",		private String LateTime;//": "30",		private String AbsenceTime;//": "120",		private String RemindCheckIn;//": "5",		private String RemindCheckOut;//": "5",		private String AdvancedCheckIn;//": "5",		private String LateCheckOut;//": "",		private boolean RemindLeaveWorkCheck;//": true,		private boolean NeedPhoto;//": true,		private boolean FastCheckIn;//": false,		private String DefaultOnDutyTime;//": ""		private double DistanceRange;		public double getDistanceRange() {			return DistanceRange;		}		public void setDistanceRange(double distanceRange) {			DistanceRange = distanceRange;		}		public String getFlexTime() {			return FlexTime;		}		public void setFlexTime(String flexTime) {			FlexTime = flexTime;		}		public String getLateTime() {			return LateTime;		}		public void setLateTime(String lateTime) {			LateTime = lateTime;		}		public String getAbsenceTime() {			return AbsenceTime;		}		public void setAbsenceTime(String absenceTime) {			AbsenceTime = absenceTime;		}		public String getRemindCheckIn() {			return RemindCheckIn;		}		public void setRemindCheckIn(String remindCheckIn) {			RemindCheckIn = remindCheckIn;		}		public String getRemindCheckOut() {			return RemindCheckOut;		}		public void setRemindCheckOut(String remindCheckOut) {			RemindCheckOut = remindCheckOut;		}		public String getAdvancedCheckIn() {			return AdvancedCheckIn;		}		public void setAdvancedCheckIn(String advancedCheckIn) {			AdvancedCheckIn = advancedCheckIn;		}		public String getLateCheckOut() {			return LateCheckOut;		}		public void setLateCheckOut(String lateCheckOut) {			LateCheckOut = lateCheckOut;		}		public boolean getRemindLeaveWorkCheck() {			return RemindLeaveWorkCheck;		}		public void setRemindLeaveWorkCheck(boolean remindLeaveWorkCheck) {			RemindLeaveWorkCheck = remindLeaveWorkCheck;		}		public boolean getNeedPhoto() {			return NeedPhoto;		}		public void setNeedPhoto(boolean needPhoto) {			NeedPhoto = needPhoto;		}		public boolean getFastCheckIn() {			return FastCheckIn;		}		public void setFastCheckIn(boolean fastCheckIn) {			FastCheckIn = fastCheckIn;		}		public String getDefaultOnDutyTime() {			return DefaultOnDutyTime;		}		public void setDefaultOnDutyTime(String defaultOnDutyTime) {			DefaultOnDutyTime = defaultOnDutyTime;		}	}	public static class UserSettingsItem{		private String shiftMethodCode;//": "1",		private String shiftTypeCode;//": "0",		private int checkTimes;//": "1",		private String startTime1;//": "08:00",		private String endTime1;//": "17:00",		private String startTime2;//": "",		private String endTime2;//": "",		private String startTime3;//": "",		private String endTime3;//": "",		private String description;//": "",		private String holidayrest;//": "true",		private long flexTime;//": "",		private long lateTime;//": "",		private String absenceTime;//": ""		@JSONField(serialize=false)		public String getOnTime(int todayCount){			switch(todayCount){			case 0:return this.getStartTime1();			case 1:return this.getEndTime1();			case 2:return this.getStartTime2();			case 3:return this.getEndTime2();			case 4:return this.getStartTime3();			case 5:return this.getEndTime3();			}			return "";		}		//-1迟到，0，正常，1早退		@JSONField(serialize=false)		public  int  getCurrState(int todayCount){			//todayCount 表示今天第几次打卡		    long  temp = getFlexTime()+getLateTime();			//看看是否迟到或者早退			//第一次打卡迟到			if(todayCount==0&&isLater(getStartTime1(),temp)){				return -1;			}			//第二次打卡早退			else if(todayCount==1&&isOut(getEndTime1(), getFlexTime())){		    	return 1;			}		    //第三次打卡早退			else if(todayCount==2&&isLater(getStartTime2(),temp)){		    	return -1;			}		    //第四次打卡早退			else if(todayCount==3&&isOut(getEndTime2(), getFlexTime())){		    	return 1;			}		    //第五次打卡早退			else if(todayCount==4&&isLater(getStartTime3(),temp)){		    	return -1;			}		    //第四次打卡早退			else if(todayCount==5&&isOut(getEndTime3(), getFlexTime())){		    	return 1;			}		    return 0;		}		//取得当前应该签到哪一个		public int getIdex(int count){				Calendar calendar = Calendar.getInstance();			int h = calendar.get(Calendar.HOUR_OF_DAY);			int m = calendar.get(Calendar.MINUTE);			long currTime = h*60+m;			long[] arr = new long[]{getStartTime12Int()+getFlexTime()			,getEndTime12Int()+getFlexTime()			,getStartTime22Int()+getFlexTime()			,getEndTime22Int()+getFlexTime()			,getStartTime32Int()+getFlexTime()			,getEndTime32Int()+getFlexTime()			};			int index = -1;			for(int i=Math.min(arr.length,count)-1;i>=0;i--){				if(currTime<arr[i]){					index = i;				}			}			return index;		}		//是否迟到		@JSONField(serialize=false)		public static boolean isLater(String timeCheckIn,long flexTime){			if(ParamsCheckUtils.isNull(timeCheckIn)){				return true;			}			SimpleDateFormat dateFormat = new SimpleDateFormat("HH:mm");			String currTime = dateFormat.format( new Date() ); 			long sCurrTime = time2L(currTime);			long sCheckin = time2L(timeCheckIn)+flexTime;			if(sCheckin<sCurrTime){				return true;			}			return false;		}		//是否是早退		@JSONField(serialize=false)		public static boolean isOut(String timeCheckIn,long flexTime){			if(ParamsCheckUtils.isNull(timeCheckIn)){				return true;			}			SimpleDateFormat dateFormat = new SimpleDateFormat("HH:mm");			String presetTime = dateFormat.format( new Date() );			long sPreset = time2L(presetTime);			long sCheckin = time2L(timeCheckIn)+flexTime;			if(sCheckin>sPreset){				return true;			}			return false;		}				@JSONField(serialize=false)		public static long time2L(String time){			try{				String[] s = time.split(":");				int i = Integer.parseInt(s[0]);				int j = Integer.parseInt(s[1]);				return i*60+j;			}catch(Exception e){				return 0;			}		}		public String getShiftMethodCode() {			return shiftMethodCode;		}		public void setShiftMethodCode(String shiftMethodCode) {			this.shiftMethodCode = shiftMethodCode;		}		public String getShiftTypeCode() {			return shiftTypeCode;		}		public void setShiftTypeCode(String shiftTypeCode) {			this.shiftTypeCode = shiftTypeCode;		}		public int getCheckTimes() {			return checkTimes;		}		public void setCheckTimes(int checkTimes) {			this.checkTimes = checkTimes;		}			public String getStartTime1() {			return startTime1;		}		public void setStartTime1(String startTime1) {			this.startTime1 = startTime1;		}		public String getEndTime1() {			return endTime1;		}		public void setEndTime1(String endTime1) {			this.endTime1 = endTime1;		}		public String getStartTime2() {			return startTime2;		}		public void setStartTime2(String startTime2) {			this.startTime2 = startTime2;		}		public String getEndTime2() {			return endTime2;		}		public void setEndTime2(String endTime2) {			this.endTime2 = endTime2;		}		public String getStartTime3() {			return startTime3;		}		public void setStartTime3(String startTime3) {			this.startTime3 = startTime3;		}		public String getEndTime3() {			return endTime3;		}		public void setEndTime3(String endTime3) {			this.endTime3 = endTime3;		}		public String getDescription() {			return description;		}		public void setDescription(String description) {			this.description = description;		}		public String getHolidayrest() {			return holidayrest;		}		public void setHolidayrest(String holidayrest) {			this.holidayrest = holidayrest;		}		public long getFlexTime() {			return flexTime;		}		public void setFlexTime(long flexTime) {			this.flexTime = flexTime;		}		public long getLateTime() {			return lateTime;		}		public void setLateTime(long lateTime) {			this.lateTime = lateTime;		}		public String getAbsenceTime() {			return absenceTime;		}		public void setAbsenceTime(String absenceTime) {			this.absenceTime = absenceTime;		}		@JSONField(serialize=false)		public int getCheckTimes2Int() {			if ("3".equals(getShiftMethodCode()))			{				return 30;//自由打卡时间			}			return checkTimes*2;		}		@JSONField(serialize=false)		public long getStartTime12Int() {			return time2L(startTime1);		}		@JSONField(serialize=false)		public long getStartTime22Int() {			return time2L(startTime2);		}		@JSONField(serialize=false)		public long getStartTime32Int() {			return time2L(startTime3);		}		@JSONField(serialize=false)		public long getEndTime12Int() {			return time2L(endTime1);		}		@JSONField(serialize=false)		public long getEndTime22Int() {			return time2L(endTime2);		}		@JSONField(serialize=false)		public long getEndTime32Int() {			return time2L(endTime3);		}	}}